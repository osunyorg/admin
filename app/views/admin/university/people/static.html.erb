<%
# this version has to be incremented every time you change something in the file, to invalidate the cache
version = 9
person = @l10n.about
university = person.university
language = @l10n.language
cache_key = [person, @l10n, @website&.id, version]
cache cache_key do
%>---
<%= osuny_static_text 'linkTitle', @l10n.to_s_alphabetical %>
<%= render 'admin/application/static/core', about: @l10n %>
<%= render 'admin/application/static/breadcrumbs', about: @l10n %>
<%= render 'admin/application/static/design',
            about: person,
            l10n: @l10n,
            full_width: true,
            toc_offcanvas: true %>
<%= render 'admin/application/meta_description/static', about: @l10n %>
<%= render 'admin/application/summary/static', about: @l10n %>
<%= render 'admin/application/l10n/static', about: @l10n %>
<%= osuny_static_text 'person', @l10n.to_s %>
<%= osuny_static_text 'first_name', @l10n.first_name %>
<%= osuny_static_text 'last_name', @l10n.last_name %>
<% 
# Peut-on supprimer les contact details à la racine ? 
# phone, email, twitter, linkedin, website
# Ils devraient être déjà dans admin/application/contact_details/static
%>
<% if person.phone_mobile_is_public? %>
<%= osuny_static_text 'phone', person.phone_mobile %>
<% end %>
<% if person.email_is_public? %>
<%= osuny_static_text 'email', person.email %>
<% end %>
<% if person.twitter_is_public? %>
<%= osuny_static_text 'twitter', @l10n.twitter %>
<% end %>
<% if person.linkedin_is_public? %>
<%= osuny_static_text 'linkedin', @l10n.linkedin %>
<% end %>
<%= osuny_static_text 'website', @l10n.url %>
<%= render 'admin/application/contact_details/static',
            about: person,
            l10n: @l10n,
            language: language %>
<% if person.best_picture.attached? %>
image:
  id: "<%= person.best_picture.blob.id %>"
  alt: ""
<%= osuny_static_html 'credit', @l10n.picture_credit, depth: 2 %>
<% end %>
roles:
<% if @l10n.author.should_sync_to?(@website) %>
  - author
<% end %>
<% if @l10n.teacher.should_sync_to?(@website) %>
  - teacher
<% end %>
<% if @l10n.researcher.should_sync_to?(@website) %>
  - researcher
<% end %>
<% if @l10n.administrator.should_sync_to?(@website) %>
  - administrator
<% end %>
<% if person.involvements_as_teacher.any? %>
teachings:
<% person.involvements_as_teacher.each do |involvement|
    involvement_l10n = involvement.best_localization_for(language)
    next if involvement_l10n.nil?
    program = involvement.target
    program_l10n = program.best_localization_for(language)
    next if program_l10n.nil?
    hugo = program_l10n.hugo(@website)
    next if hugo.file.blank?
    %>
  - program:
      permalink: "<%= hugo.permalink %>"
      path: "<%= hugo.path %>"
      slug: "<%= hugo.slug %>"
      file: "<%= hugo.file %>"
<%= osuny_static_text 'title', program_l10n.to_s, depth: 4 %>
<%= osuny_static_text 'description', involvement_l10n.description, depth: 3 %>
<% end %>
<% end %>
<% if person.roles_as_administrator.any? %>
administrative_missions:
<% person.roles_as_administrator.each do |role|
    role_l10n = role.best_localization_for(language)
    next if role_l10n.nil?
    target = role.target
    target_l10n = target.best_localization_for(language)
    next if target_l10n.nil?
    hugo = target_l10n.hugo(@website)
    next if hugo.file.blank?
    %>
  - target:
      permalink: "<%= hugo.permalink %>"
      path: "<%= hugo.path %>"
      slug: "<%= hugo.slug %>"
      file: "<%= hugo.file %>"
<%= osuny_static_text 'title', target_l10n.to_s, depth: 4 %>
<%= osuny_static_text 'description', role_l10n.to_s, depth: 3 %>
<% end %>
<% end %>
cohorts:
<% person.cohorts.each do |cohort|%>
  <%
    cohort_l10n = cohort.best_localization_for(language)
    next if cohort_l10n.nil?
    hugo = cohort_l10n.hugo(@website)
    next if hugo.file.blank?
  %>
  - permalink: "<%= hugo.permalink %>"
    path: "<%= hugo.path %>"
    slug: "<%= hugo.slug %>"
    file: "<%= hugo.file %>"
<%= osuny_static_text 'title', cohort_l10n.to_s, depth: 3 %>
<% end %>
<%= render 'admin/application/connections/backlinks', about: @l10n %>
<%= render 'admin/application/categories/widget/static',
            about: person,
            l10n: @l10n,
            categories: university.person_categories,
            key: :persons_categories %>
<%= osuny_static_html 'biography', @l10n.biography %>
<%= render 'admin/communication/contents/static', about: @l10n %>
---
<% end %>